<div class="card m-5">
  <div class="card-title p-5 pb-3 pt-3 rounded-top bg-primary d-flex justify-content-between align-items-center">
    <h1 class="fw-bolder text-white"><i class="fa fa-shopping-cart fs-2" aria-hidden="true"></i>&nbsp;&nbsp;Raise Delivery Order</h1>


    <button style="color: black !important;" class="btn btn-icon btn-sm bg-secondary cursor-pointer " title="back"
      routerLink="/ims/ImsTrnAddDeliveryorder"><i class="fa-solid fa-arrow-left-long fs-1 fw-bold"></i></button>


  </div>
  <!-- -------------- First Tab ------------- -->
  <div class="card mt-1 m-3 mb-0">
    <div
      class="card-header d-flex align-items-center mb-3 cursor-pointer no-arrow" style="background-color: #def0ff;">
      <div>
        <p class="card-title fw-bold fs-3 no-arrow" style="color: #2599ff;">
          <i class="fa-solid fa-clipboard fs-1"></i> &nbsp;&nbsp;Order Details
        </p>
      </div>
    </div>

    <div>
      <form [formGroup]="deliveryform" #form="ngForm">
        <input type="hidden" formControlName="customer_gid">
        <div  class="d-flex flex-row m-2 flex-wrap">
          <!-- -------------- Entity ------------- -->
        <div class="col-12 col-lg-4 col-md-4 col-sm-12">
          <span class="font-bold">Branch</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"   formControlName="branch_name" 
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
              placeholder="Branch" style="height:40px;"  />
          </div>
        </div>
        <!-- --------------Delivery No ------------- -->
        <div class="col-12 col-lg-4 col-md-6 col-sm-12">
          <span class="font-bold" [ngClass]="{'error_input_field': dc_no.invalid && dc_no.touched }">Delivery No<span class="ms-1 text-red">*</span></span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text" formControlName="dc_no" [ngClass]="{'invalid-border': dc_no.invalid && dc_no.touched}" 
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
              placeholder="Delivery No" style="height:40px;" />
          </div>
        </div>
          <!-- -------------- Delivery Date  ------------- -->
        <div class="col-12 col-lg-4 col-md-6 col-sm-12">
                 <span class="font-bold" >Delivery Date <span class="ms-1 text-red">*</span></span>
                <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                    <input type="date"   pattern="^(?!\s*$).+" [ngStyle]="{ 'border-color': deliveryform.get('salesorder_date')?.hasError('required')
                    && deliveryform.get('salesorder_date')?.touched ? 'red' : 'rgb(209, 209, 209)'}"
                    formControlName="salesorder_date"
                    class="form-control form-control-lg form-control-solid date-picker custom-input mb-3 mb-lg-0 bg-white
                    custom-input date-picker "  placeholder="DD-MM-YYYY" style="height: 40px;"/>
            </div>
          </div>         
        </div>
        <div class="d-flex flex-row m-2 flex-wrap">
          <div class="col-12 col-lg-4 col-md-3 col-sm-12">
               <!-- -------------- Customer------------- -->
            <span class="font-bold">Customer</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">           
              <input type="text" formControlName="customer_name"  
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
              placeholder="Customer" style="height:40px;" readonly />
            </div>
            <div class="col-11  fv-row mt-2 ">
              <textarea type="text"
              class=" mt-4 form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-secondary border-secondary custom-input"
              placeholder="Customer Details"  formControlName="customer_details" class="form-control" readonly
              rows="5"></textarea>
            </div>
          </div>
          <!-- -------------- Shipment To ------------- -->
          <div class="col-12 col-lg-4 col-md-3 col-sm-12">
            <span class="font-bold">Shipment To</span>
            <div class="col-11 fv-row mt-2">
              <textarea type="text"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-secondary border-secondary custom-input"
                placeholder="Shipment To"  formControlName="customer_address_so" class="form-control"
                rows="7" readonly></textarea>
            </div>
          </div>    
            <div class="col-12 col-lg-4 col-md-3 col-sm-12">
                <!-- -------------- Mode Of Despatch------------- --> 
            <span class="font-bold">Mode Of Despatch</span>
            <div class="col-11  fv-row mt-2">           
                 <!-- <ng-select style="height:25px;"  [items]="modeofdispatch_list"
                  class="custom col-lg-12 col-12 fv-row no-arrow"
                   bindLabel="name"
                  formControlName="customer_mode" bindValue="id" placeholder="Select an option"> </ng-select> -->

                  <input type="text" formControlName="customer_mode"  
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
              placeholder="Mode Of Dispatch" style="height:40px;" />
            </div>
            <div class="col-11  fv-row mt-2">
              <input type="text" formControlName="tracker_id"  
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
              placeholder="Delivery Tracking No" style="height:40px;" />
            </div>
            <div class="col-11  fv-row mt-2">
              <input type="number" formControlName="no_of_boxs"  
              class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
               placeholder="No of Boxes" style="height:40px;" />
            </div>
          </div> 
      </div>

       <!-- -------------- Delivery Note   ------------- -->
       <div class="d-flex flex-row m-2 flex-wrap">
        <div class="col-12 col-lg-12 col-md-4 col-sm-12"><span class="font-bold">Delivery Note</span>
          <div class="col-lg-12 col-12 col-md-4 col-sm-11 fv-row mt-2">
            <textarea style="width: 97%;" type="text" class="
              form-control form-control-lg form-control-solid custom-input
              mb-3 mb-lg-0  borderc-secondary bg-white custom-input" formControlName="dc_note"
              placeholder="Delivery Note" class="form-control " rows="3"></textarea>
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <div class="card card-body m-0 p-3 mb-5 bg-white rounded table-responsive">
          <table  id="raisedeliveryorder_list1"  class="table table-striped table-bordered text-blue border-bottom gs-7 align-middle" >
            <thead class="table_head">
              <tr class="fw-bold fs-6 text-nowrap bg-lightblue text-blue align-middle">
                <th class="text-blue text-center" style="width: 1px;">S.No</th>
                <th class="text-blue text-center">Product Group</th>
                <th class="text-blue text-center">Product Code</th>
                <th class="text-blue text-center">Product </th>
                <th class="text-blue text-center" >Description</th>
                <th class="text-blue text-center" style="width: 15px;">Qty Ordered</th>
                <th class="text-blue text-center" style="width: 15px;">Qty Delivered</th>
                <th class="text-blue text-center" style="width: 15px;">Despatch Qty</th>
                <th class="text-blue text-center" style="width: 15px;">Action</th> 
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of raisedeliveryorder_list1; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ data.productgroup_name }}</td>
                <td>{{ data.product_code }} </td>
                <td>{{ data.product_name }}</td>
                <td>{{ data. product_remarks }}</td>
                <td style="text-align: right;padding-right: 5px;">{{ data.qty_quoted }}</td>
                <td style="text-align: right;padding-right: 5px;">{{ data.product_delivered }}</td>
                <td style="text-align: right;padding-right: 5px;">{{data.qty_issued}}</td>
                <td style="text-align:center">
                  <ng-container  *ngIf="data.producttype_name !== 'Services';else Service"> 
                    <span 
                    *ngIf="data.product_delivered === data.qty_quoted" >
                      Delivered
                    </span>
                    <button 
                    *ngIf="!!data.available_quantity && data.available_quantity !== '0' && data.product_delivered !== data.qty_quoted"
                    title="Select" 
                    type="button" 
                    class="btn-lg btn-primary" 
                    data-bs-toggle="modal"
                    data-bs-target="#myModaladd"
                    (click)="onadd(data.salesorder_gid, data.product_gid, data.salesorderdtl_gid)" 
                    style="height: 20px; display: flex; align-items: center; justify-content: center;">
                      Select
                    </button>
                    <span 
                    *ngIf="!data.available_quantity || data.available_quantity === '0' && data.product_delivered !== data.qty_quoted"
                    class="text-center"
                    style=" display: flex;">
                      Stock Not Available
                    </span>
                    </ng-container>
                    <ng-template #Service >
                      <div style="width: 100%; text-align: center;">
                      <span style="color: red;"> Service Product</span>
                      </div>
                  </ng-template>
                </td>      
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </form>
  </div> 
  <div class="text-center my-4">

    <button class="btn-success btn-sm text-white me-2" [disabled]="deliveryform.invalid"
          [ngClass]="{'primary-button': !deliveryform.invalid,'secondary-button': deliveryform.invalid}"
          (click)="onSubmitDO()">
          <i class="fas fa-check text-white fs-5"></i> &nbsp; Submit
        </button>


    <!-- <button class="btn-success btn-sm text-white me-2" [disabled]="deliveryform.invalid"
          [ngClass]="{'primary-button': !deliveryform.invalid,'secondary-button': deliveryform.invalid}"
          (click)="onSubmitDO()">
          <i class="fas fa-check text-white fs-5"></i> &nbsp; Submit
        </button> -->
  </div>
</div>
</div>
            <div class="modal fade" id="myModaladd" tabindex="-1" data-bs-backdrop='static'
            aria-labelledby="editamlcategoryLabel" aria-hidden="true" data-bs-keyboard="false">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content d-flex justify-content-center">
            <div class="card-header p-1 pb-2 pt-1 rounded-top bg-primary">
              <h2 style="margin-top: 10px; color: white; font-weight: bold">
                &nbsp;&nbsp;<i class="fa fa-shopping-cart fs-2" aria-hidden="true"></i>&nbsp;&nbsp; Select Issue Quantity
              </h2>
            </div>
            <div>
              <!--product summary-->
              <div class="table-responsive">
                <div class="card card-body table-responsive bg-white rounded" >
                  <table id="products_list" class="table table-striped table-bordered text-blue border-bottom gs-7 align-middle" >
                    <thead>
                      <tr class="fw-bold fs-6 text-nowrap bg-lightblue text-blue align-middle">
                        <th class="text-blue text-center">Product</th>
                        <th class="text-blue text-center">Unit</th>
                        <th class="text-blue text-center">Description</th>
                        <th class="text-blue text-center">Outstanding Qty</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let data of OutstandingQty_list; let i = index">
                        <td>
                          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                            {{ data.product_name }}
                          </div>
                        </td>
                        <td>
                          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2 me-5 text-center"  >
                            {{ data.uom_name }}
                          </div>
                        </td>
                        <td>
                          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                            {{ data.product_remarks }}
                          </div>
                        </td>
                        <td style="text-align: right;">
                          <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                            {{ data.outstanding_qty }}
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
                <form [formGroup]="deliveryform1">
                  <div class="table-responsive">
                    <div class="card card-body table-responsive bg-white rounded">
                      <table id="IssuedQty_list" class="table table-striped table-bordered text-blue border-bottom gs-7 align-middle" >
                        <thead>
                          <tr class="fw-bold fs-6 text-nowrap bg-lightblue text-blue align-middle">
                            <th class="text-blue text-center">Stock Date</th>
                            <th class="text-blue text-center">Stock Ref No</th>
                            <th class="text-blue text-center" style="width: 20%;">Description</th>
                            <th class="text-blue text-center">GRN REf No</th>
                            <th class="text-blue text-center">Stock In Hand</th>
                            <th class="text-blue text-center" style="width: 15%;">Qty Issued</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let data of IssuedQty_list; let i = index" >
                            <td>
                              <div class="col-lg-12 col-6 col-md-11 col-sm-11 fv-row mt-2">
                                {{ data.created_date }}
                              </div>
                            </td>

                            <td>
                              <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                                {{ data.reference_gid }}
                              </div>
                            </td>

                            <td>
                              <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                                {{ data.product_remarks }}
                              </div>
                            </td>

                            <td>
                              <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                                {{ data.stock_gid }}
                              </div>
                            </td>

                            <td>
                              <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2" style="text-align: right;">
                                {{ data.stock_qty }}
                              </div>
                            </td>
                            <td>
                              <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
                              <input type="hidden" formControlName="salesorder_gid"/>
                              <input type="hidden" formControlName="product_gid"/>
                                <input
                                  type="text"
                                  style="text-align: right"
                                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input"
                                  placeholder="0.00"
                                  formControlName="total_amount"
                                  class="form-control"/>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="text-center my-4 mb-5">
                    <button (click)="OnSubmit()" type="submit" class="btn-success btn-sm text-white  me-2" data-bs-dismiss="modal"><i class="fas fa-check text-white fs-5"></i> 
                      <span class="ms-3">Submit</span>
                    </button>
                    <button class="btn-primary btn-sm text-white me-4" data-bs-dismiss="modal" (click)="onclose()" ><i class="fas fa-arrow-left fs-5"> </i>&nbsp;Back</button>
                </div>
                </form>
        </div>
      </div>
    </div>
  
</div>








 
          