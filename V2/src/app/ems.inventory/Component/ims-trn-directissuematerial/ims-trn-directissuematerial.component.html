<div class="card mt-4">
  <div class="card-title p-5 pb-3 pt-3 rounded-top bg-primary d-flex justify-content-between align-items-center">
    <h1 class="fw-bolder text-white"><i class="fa fa-shopping-cart fs-2" aria-hidden="true"></i>&nbsp;&nbsp; Direct
      Material Issue</h1>


    <button style="color: black !important;" class="btn btn-icon btn-sm bg-secondary cursor-pointer " title="back"
      routerLink="/ims/ImsTrnIssuematerialSummary"><i class="fa-solid fa-arrow-left-long fs-1 fw-bold"></i></button>


  </div>

  <!-- -------------- First Tab ------------- -->
  <div class="card mt-1 m-3 mb-0">
    <div (click)="toggleCollapse('section1')" (click)="sample()"
      class="card-header d-flex align-items-center mb-3 cursor-pointer" style="background-color: #def0ff;">
      <div>
        <p class="card-title fw-bold fs-3" style="color: #2599ff;">
          <i class="fa-solid fa-clipboard fs-1"></i> &nbsp;&nbsp;Issue Details
        </p>
      </div>
      <!-- <div class="ms-auto pt-1 ">
        <button class="btn text-decoration-none " style="color: #2599ff;">
          <i class="fa-solid fa-caret-down fs-1" *ngIf="!sam"></i>
          <i class="fa-solid fa-caret-up fs-1" *ngIf="sam"></i>
        </button>
      </div> -->
    </div>

    <!-- <div class="collapse" [ngbCollapse]="isCollapsed['section1']"> -->
    <form [formGroup]="IssuematerialForm">
      <div class="card m-6 border mt-2">
        <div class="d-flex flex-row ms-10 m-2 flex-wrap">
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold">Branch</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class=" form-control form-control-lg form-control-solid bg-white custom-input 
          mb-3 mb-lg-0 borderc-secondary" placeholder="Branch" readonly formControlName="branch_name" />
            </div>
          </div>
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold ">Ref.No</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class=" form-control form-control-lg form-control-solid bg-white custom-input bg-white 
              mb-3 mb-lg-0 borderc-secondary" name="MI Ref No" readonly placeholder="Auto Generate" />
            </div>
          </div>

          <div class="col-12 col-lg-4 col-md-6 col-sm-12 ">
            <span class="font-bold required">Date</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="date" formControlName="materialissued_date"
                [ngStyle]="{ 'border-color': IssuematerialForm.get('materialissued_date')?.hasError('required') && IssuematerialForm.get('materialissued_date')?.touched ? 'red' : 'rgb(209, 209, 209)' , 'height': '42px'}"
                class="form-control form-control-lg form-control-solid date-picker custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2"
                placeholder="DD-MM-YYYY" />
              <div
                *ngIf="IssuematerialForm.get('materialissued_date')?.hasError('required') && IssuematerialForm.get('materialissued_date')?.touched"
                class="text-red">
                MI Date is required.
              </div>
            </div>
          </div>
          
        </div>

        <div class="d-flex flex-row ms-10 m-2 flex-wrap">
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold ">Department</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" readonly class=" form-control form-control-lg form-control-solid bg-white custom-input 
            mb-3 mb-lg-0 borderc-secondary" name="department_name" formControlName="department_name" placeholder="" />
            </div>
          </div>

          <!-- <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold ">Requested By</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" readonly class=" form-control form-control-lg form-control-solid bg-white custom-input 
            mb-3 mb-lg-0 borderc-secondary" name="user_firstname" placeholder="Raised By"
                formControlName="user_firstname" />
            </div>
          </div> -->
          <div class="col-12 col-lg-4 col-md-3 col-sm-12">
            <span class="font-bold required">Requested By</span>
            <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2 no-arrow">
              <ng-select style="margin-top: -10px;" [items]="user_list"
                      class="custom col-lg-11 col-12 fv-row mt-2"  (change)="OnChangerequestor()" (clear)="onclearrequestor()"
                       bindLabel="employee_name"
                      formControlName="employee_name" bindValue="user_gid" placeholder="Requested by"
                      [(ngModel)]="mdlUserName" required>
                   </ng-select>
            </div>
          </div>
          <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Location</span>
            <ng-select formControlName="location_name" [items]="imslocation_list"
              class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2" bindLabel="location_name"
              bindValue="location_name" placeholder="Select Location"></ng-select>
          </div>
        </div>


        <div class="d-flex flex-row ms-10 m-2 me-13 flex-wrap">
          <!-- <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Cost Center Name
    </span>
      <ng-select formControlName="costcenter_name" [items]="imscostenter_list"
      class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2" bindLabel="costcenter_name"
      bindValue="costcenter_gid" placeholder="Select Cost Center Name" 
      (change)="OnChangeamount()"></ng-select>
  </div> -->

          <!-- <div class="col-12 col-lg-4 col-md-6 col-sm-12">
      <span class="font-bold ">Available Amount</span>
      <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
          <input  type="text"  style="text-align: right;" class=" form-control form-control-lg form-control-solid bg-white custom-input bg-secondary 
          mb-3 mb-lg-0 borderc-secondary"  
          name="available_amount" readonly formControlName="available_amount" placeholder="0.00"/>
      </div>
  </div> -->

          <div class="col-12 col-lg-12 col-md-6 col-sm-12 ">
            <span class="font-bold ">Remarks</span>
            <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2 me-20">
              <textarea type="text" formControlName="materialrequisition_remarks" name="materialrequisition_remarks"
                class="form-control form-control-lg form-control-solid borderc-secondary bg-white resize_none"
                placeholder="Enter MI Remarks" rows="3"></textarea>

            </div>
          </div>

          <!-- </div>
  <div class="d-flex flex-row ms-10 m-6 mt-3 flex-wrap">  -->
          <!-- <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold ">Reference</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <textarea type="text" formControlName="materialrequisition_reference" name="materialrequisition_reference"
                class="form-control form-control-lg form-control-solid borderc-secondary bg-white resize_none"
                placeholder="Enter MI Ref" rows="3"></textarea>
            </div>
          </div> -->
        </div>
      </div>
    </form>
    <!-- </div> -->
  </div>
  <!-- --------------Second Tab ------------- -->
  <div class="card mt-1 m-3 mb-0">

    <form [formGroup]="productform">
      <table class="table table-striped table-bordered text-blue border-bottom gs-7 align-middle">
        <!-- <thead>
          <tr class="fw-bold fs-7 text-nowrap bg-lightblue text-blue align-middle">
            <th class="text-left text-blue" style="width: 15%;">Product Group</th>
            <th class="text-left text-blue" style="width: 15%;">Product Code</th>
            <th class="text-center text-blue" style="width: 20%;">Product</th>
            
            <th class="text-center text-blue" style="width: 15%;">Description</th>
            <th class="text-center text-blue" style="width: 10%;">Unit</th>
            <th class="text-center text-blue" style="width: 10%;">Qty Requested</th>
            
            <th class="text-center text-blue" style="width: 10%;">Available Stock</th>
            <th class="text-center text-blue" style="width: 5%;">Action</th>
          </tr>
        </thead> -->

        <thead>
          <tr class="fw-bold fs-5 text-nowrap bg-lightblue text-blue">
            
            <th class="text-center text-blue" style="width: 15%;">Product Group</th>
            <th class="text-center text-blue" style="width: 15%;">Product Code</th>
            <th class="text-center text-blue"style="width: 15%;">Product</th>
            <th class="text-center text-blue"style="width: 15%;">Description</th>
            <th class="text-center text-blue"style="width: 10%;">Product Unit</th>
            <th class="text-center text-blue"style="width: 10%;">Requested Qty </th>
            <th class="text-center text-blue" style="width: 10%;">Available Stock</th>
            <th class="align-center text-blue"style="width: 5%;">Action</th>
          </tr>
        </thead>
        <tbody>


          <tr>
            <td class="pt-1 pb-1 custom-padding">
              <ng-select formControlName="productgroup_name" (change)="GetOnChangeProductsGroup()"
                [class.is-invalid]="productgroup_name.invalid && (productgroup_name.dirty || productgroup_name.touched)"
                [items]="Getproductgroup" required bindLabel="productgroup_name" class="fixed-width custom-ng-select"
                bindValue="productgroup_gid" [(ngModel)]="productsearch" appendTo="body" placeholder="Select product Group"
                class="no-arrow custom-placeholder ">
              </ng-select>

            </td>
            <td class="custom-padding">

              <ng-select formControlName="product_code"
                [class.is-invalid]="product_code.invalid && (product_code.dirty || product_code.touched)"
                [items]="IMSProductList1" required bindLabel="product_code" bindValue="product_code"
                (clear)="onclearproductcode()" (change)="OnProductCode($event)" [(ngModel)]="productcodesearch1" placeholder="Select Prodcut Code"
                appendTo="body" class="no-arrow ">
              </ng-select>

            </td>
            <td class=" custom-padding" style="max-width: 80% !important;">
              <ng-select formControlName="product_name"
                [class.is-invalid]="product_name.invalid && (product_name.dirty || product_name.touched)"
                [items]="IMSProductList1" required bindLabel="product_name" bindValue="product_gid"
                (clear)="onclearproduct()" (change)="onProductSelect($event)" [(ngModel)]="productcodesearch" placeholder="Select Product"
                appendTo="body" class="no-arrow ">
              </ng-select>

            </td>
            
            <td class=" custom-padding">
              <textarea
                class="form-control form-control-lg form-control-solid custom-input custom_height borderc-secondary bg-white custom-input"
                formControlName="display_field" (change)="onProductSelect($event)" (clear)="onclearproduct()"
                [(ngModel)]="display_field"
                ></textarea>
            </td>
            <td class=" custom-padding" >
              <input type="text"
                class="form-control form-control-lg form-control-solid custom-input custom_height borderc-secondary bg-white custom-input"
               style="text-align: right;" formControlName="productuom_name" (change)="onProductSelect($event)"
                [(ngModel)]="productquantity" readonly>
            </td>
            
            <td class=" custom-padding">
              <input type="number"
                class="form-control form-control-lg form-control-solid custom-input mt-3 mb-lg-3 borderc-secondary bg-white custom-input"
                style="height:20px; text-align: right;" formControlName="qty_requested" placeholder="0.00">
            </td>
            
            
            <td class=" custom-padding">
              <div class="d-flex">
                <input type="number" class=" form-control form-control-lg form-control-solid bg-white custom-input 
                          mb-3 mb-lg-0 borderc-secondary"(change)="onProductSelect($event)"
                  style="height:20px; text-align: right;" formControlName="stock_quantity" readonly>
              </div>
            </td>
            <td style="width: 5%;" class="text-center">
              <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                &nbsp;&nbsp;<button title="Add" (click)="IssueMaterial()" type="button"
                  class="btn btn-icon btn-sm bg-success me-1">
                  <span Class="fa-solid fa-plus text-white  fs-6"></span></button>&nbsp;
              </div>
            </td>
          </tr>
          <tr *ngFor="let data of productsummary_list; let i=index;">
            <td>{{data.productgroup_name}}</td>
            <td>{{data.product_code}}</td>
            <td style="text-align: left;">{{data.product}}</td>
            <td style="text-align: center;">{{data.display_field}}</td>
            <td style="text-align: right;">{{data.productuom_name}}</td>
            <td style="text-align: right;">{{data.qty_requested}} </td>
            <td style="text-align: right;">{{data.stock_quantity}}</td>
            <td class="text-center">
              <button type="button" data-bs-toggle="modal" data-bs-target="#myModaldeleteQA" (click)="openModaldelete(data.tmpmaterialrequisition_gid)"
                class="btn btn-icon btn-sm bg-danger me-1">
                <i class="fa-solid fa-trash"></i>

              </button>
            </td>

          </tr>
        </tbody>

      </table>
    </form>
    <!-- </div> -->
  </div>
  <!-- --------------Third Tab ------------- -->

  <div class="card mt-1 m-3 mb-0">
    <!-- <div class="card-header d-flex align-items-center mb-3 cursor-pointer rounded-top"
        (click)="toggleCollapse('section3')" (click)="arrowone()" style="background-color: #def0ff;">
        <div>
          <p class="card-title fw-bold fs-3" style="color: #2599ff;">
            <i class="fa-solid fa-clipboard-list fs-1"></i> &nbsp; Product Summary
          </p>
        </div> -->
    <!-- <div class="ms-auto pt-1 ">
          <button class="btn text-decoration-none " style="color: #2599ff;">
            <i class="fa-solid fa-caret-down fs-1" *ngIf="!arrowOne"></i>
            <i class="fa-solid fa-caret-up fs-1" *ngIf="arrowOne"></i>
          </button>
        </div> -->
    <!-- </div> -->
    <!-- <div class="collapse" [ngbCollapse]="isCollapsed['section3']"> -->

    <form [formGroup]="IssuematerialForm">
      <div class="m-4 card">
        <div class="text-center my-4">
          <!-- <button (click)="onSubmit()" type="submit" class="btn-success btn-sm text-white me-2">
            <i class="fas fa-check fs-5"></i>
            <span class="ms-3">Submit</span> </button> -->
            <button (click)="onSubmit()" [disabled]="IssuematerialForm.invalid"
          [ngStyle]="{ 'cursor': IssuematerialForm.invalid ? 'not-allowed' : 'pointer'}" [ngClass]="{ 'btn-success': !IssuematerialForm.invalid,
        'btn-secondary text-white': IssuematerialForm.invalid }" data-bs-dismiss="modal">
          <i class="fas fa-check text-white fs-5 "></i> &nbsp;Submit
        </button>&nbsp;
        <button class="btn-primary btn-sm text-white me-4" routerLink="/ims/ImsTrnIssuematerialSummary">
          <i class="fas fa-arrow-left"></i> &nbsp;Back
        </button>

        </div>
      </div>
    </form>

    <div class="modal" id="myModaldeleteQA" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content del_modal-content">
          <div class="text-center my-4">
            <h2><b>Are you sure?</b></h2>
            <p style="display: block;">Do You Want To Delete the Record ?</p>
            <div class="text-center my-4">
              <button class="btn-danger btn-sm text-white me-4" data-bs-dismiss="modal" (click)="ondelete()">
                <i class="bi bi-trash-fill text-white fs-5 me-2"></i>Delete
              </button>
              <button class="btn-primary btn-sm text-white me-2" data-bs-dismiss="modal">
                <i class="fas fa-close text-white me-2"></i>Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- </div> -->
  </div>