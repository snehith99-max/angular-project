<div class="card m-5">
  <div class="card-title p-5 pb-3 pt-3 rounded-top bg-primary d-flex justify-content-between align-items-center">
    <h1 class="fw-bolder text-white"><i class="fa fa-shopping-cart fs-2" aria-hidden="true"></i>&nbsp;&nbsp; Create Open
      DC</h1>
    <button style="color: black !important;" class="btn btn-icon btn-sm bg-secondary cursor-pointer " title="back"
      routerLink="/ims/ImsTrnOpendc"><i class="fa-solid fa-arrow-left-long fs-1 fw-bold"></i></button>
  </div>

  <!-- -------------- First Tab ------------- -->
  <div class="card mt-1 m-3 mb-0">
    <div (click)="toggleCollapse('section1')" (click)="sample()"
      class="card-header d-flex align-items-center mb-3 cursor-pointer" style="background-color: #def0ff;">
      <div>
        <p class="card-title fw-bold fs-3" style="color: #2599ff;">
          <i class="fa-solid fa-clipboard fs-1"></i> &nbsp;&nbsp;DC Details
        </p>
      </div>
    </div>
    <form [formGroup]="opendcForm">
      <div class="card m-6 border mt-2">
        <div class="d-flex flex-row ms-10 m-2 flex-wrap">
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold ">DC Ref.No</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" class=" form-control form-control-lg form-control-solid bg-white custom-input bg-white 
                mb-3 mb-lg-0 borderc-secondary" name="MI Ref No" readonly placeholder="Auto Generate" />
            </div>
          </div>

          <div class="col-12 col-lg-4 col-md-6 col-sm-12 ">
            <span class="font-bold required">DC Date</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="date" formControlName="directorder_date"
                [ngStyle]="{ 'border-color': opendcForm.get('directorder_date')?.hasError('required') && opendcForm.get('directorder_date')?.touched ? 'red' : 'rgb(209, 209, 209)' , 'height': '42px'}"
                class="form-control form-control-lg form-control-solid date-picker custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2"
                placeholder="DD-MM-YYYY" />
              <div
                *ngIf="opendcForm.get('directorder_date')?.hasError('required') && opendcForm.get('directorder_date')?.touched"
                class="text-red">
                DC Date is required.
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold"
              [ngClass]="{'error_input_field': branch_name.invalid && branch_name.touched}">Branch<span
                class="ms-1 text-red">*</span></span>
            <div class="col-lg-12 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <ng-select formControlName="branch_name"
                [class.is-invalid]="branch_name.invalid && (branch_name.dirty || branch_name.touched)"
                [ngClass]="{'invalid-border': branch_name.invalid && branch_name.touched}" [items]="branch_list"
                required class=" col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2 no-arrow" bindLabel="branch_name"
                bindValue="branch_gid" placeholder="Select Branch">
              </ng-select>

            </div>
          </div>
        </div>
        <div class="d-flex flex-row ms-10 m-2  flex-wrap">
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold "
              [ngClass]="{'error_input_field': shipping_to.invalid && shipping_to.touched}">Shipping To <span
                class="ms-1 text-red">*</span></span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <textarea type="text" formControlName="shipping_to" name="shipping_to"
                [ngClass]="{'invalid-border': shipping_to.invalid && shipping_to.touched}"
                class="form-control form-control-lg form-control-solid borderc-secondary bg-white resize_none"
                placeholder="Enter Shipping To" rows="6"></textarea>
            </div>
          </div>
          <!-- <div class="col-12 col-lg-4 col-md-6 col-sm-12">

            <span class="font-bold"
              [ngClass]="{'error_input_field': mode_of_despatch.invalid && mode_of_despatch.touched || tracker_id.invalid && tracker_id.touched||no_of_boxs.invalid && no_of_boxs.touched}">Mode
              Of Despatch <span class="ms-1 text-red">*</span></span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <input type="text" formControlName="mode_of_despatch"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
                [ngClass]="{'invalid-border': mode_of_despatch.invalid && mode_of_despatch.touched}"
                placeholder="Mode Of Despatch" style="height:40px;" class="form-control" />
            </div>
            <div class="col-11  fv-row mt-2">
              <input type="text" formControlName="tracker_id"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
                [ngClass]="{'invalid-border': tracker_id.invalid && tracker_id.touched}"
                placeholder="Delivery Tracking No" style="height:40px;" class="form-control" />
            </div>
            <div class="col-11  fv-row mt-2">
              <input type="number" formControlName="no_of_boxs"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
                [ngClass]="{'invalid-border': no_of_boxs.invalid && no_of_boxs.touched}" placeholder="No of Boxes"
                style="height:40px;" class="form-control" />
            </div>
          </div> -->
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold ">DC Note</span>
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <textarea type="text" formControlName="dc_note" name="dc_note"
                class="form-control form-control-lg form-control-solid borderc-secondary bg-white resize_none"
                placeholder="Enter DC Note" rows="6"></textarea>
            </div>
          </div>
          <div class="col-12 col-lg-4 col-md-3 col-sm-12">
            <!-- -------------- Mode Of Despatch------------- -->
            <span class="font-bold">Mode Of Despatch </span>
            <div class="col-11  fv-row mt-2">           
              <input type="text" formControlName="mode_of_despatch"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
                placeholder="Delivery Tracking No"  pattern="^(?!\s*$).+" 
                [ngClass]="{'invalid-border': mode_of_despatch.invalid && mode_of_despatch.touched}"
                placeholder="Mode Of Despatch"  class="form-control"/>
              </div>
            <div class="col-11  fv-row mt-2">
              <input type="text" formControlName="tracker_id"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input "
                placeholder="Delivery Tracking No"  pattern="^(?!\s*$).+" 
                [ngClass]="{'invalid-border': tracker_id.invalid && tracker_id.touched}"
                placeholder="Delivery Tracking No"  class="form-control" />
            </div>
            <div class="col-11  fv-row mt-2">
              <input type="number" formControlName="no_of_boxs"
                class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 borderc-secondary bg-white custom-input " pattern="^(?!\s*$).+"
                placeholder="No of Boxes" 
                [ngClass]="{'invalid-border': no_of_boxs.invalid && no_of_boxs.touched}" placeholder="No of Boxes"
                 class="form-control"/>
            </div>
          </div>
          
        </div>
      </div>
    </form>
    <!-- </div> -->
  </div>
  <!-- --------------Second Tab ------------- -->
  <div class="card mt-1 m-3 mb-0">

    <form [formGroup]="productform">
      <table class="table table-striped table-bordered text-blue border-bottom gs-7 align-middle">
        <thead>
          <tr class="fw-bold fs-7 text-nowrap bg-lightblue text-blue align-middle">
            <th class="text-left text-blue">Product Group</th>
            <th class="text-left text-blue">Product Code</th>
            <th class="text-center text-blue" style="width: 15%;">Product</th>
            <th class="text-center text-blue" style="width: 20%;">Description</th>
            <th class="text-center text-blue">Qty Requested</th>
            <th class="text-center text-blue">Unit</th>
            <th class="text-center text-blue">Available Stock</th>
            <th class="text-center text-blue" style="width: 5%;">Action</th>
          </tr>
        </thead>
        <tbody>


          <tr>
            <td class="pt-1 pb-1 padding_custom">
              <ng-select formControlName="productgroup_name" (change)="GetOnChangeProductsGroup()"
                [class.is-invalid]="productgroup_name.invalid && (productgroup_name.dirty || productgroup_name.touched)"
                [items]="Getproductgroup" required bindLabel="productgroup_name" class="fixed-width custom-ng-select"
                bindValue="productgroup_gid" [(ngModel)]="productsearch" appendTo="body"
                class="no-arrow custom-placeholder ">
              </ng-select>

            </td>
            <td class="padding_custom">

              <ng-select formControlName="product_code"
                [class.is-invalid]="product_code.invalid && (product_code.dirty || product_code.touched)"
                [items]="IMSProductList1" required bindLabel="product_code" bindValue="product_code"
                (clear)="onclearproductcode()" (change)="OnProductCode($event)" [(ngModel)]="productcodesearch1"
                appendTo="body" class="no-arrow ">
              </ng-select>

            </td>
            <td class=" padding_custom" style="max-width: 80% !important;">
              <ng-select formControlName="product_name"
                [class.is-invalid]="product_name.invalid && (product_name.dirty || product_name.touched)"
                [items]="IMSProductList1" required bindLabel="product_name" bindValue="product_gid"
                (clear)="onclearproduct()" (change)="onProductSelect($event)" [(ngModel)]="productcodesearch"
                appendTo="body" class="no-arrow ">
              </ng-select>

            </td>
            <td class=" padding_custom">
              <textarea
                class="form-control form-control-lg form-control-solid custom-input custom_height borderc-secondary bg-white custom-input"
                formControlName="display_field"></textarea>
            </td>
            <td class=" padding_custom">
              <input type="number"
                class="form-control form-control-lg form-control-solid custom-input mt-4 mb-lg-3 borderc-secondary bg-white custom-input"
                style="height:20px; text-align: right;" formControlName="qty_requested" placeholder="0.00">
            </td>
            <td class=" padding_custom">
              <input type="text"
                class="form-control form-control-lg form-control-solid custom-input custom_height borderc-secondary bg-white custom-input"
                style="text-align: right;" formControlName="productuom_name" (change)="onProductSelect($event)"
                [(ngModel)]="productquantity" readonly>
            </td>
            <td class=" padding_custom">
              <div class="d-flex">
                <input type="number" class=" form-control form-control-lg form-control-solid bg-white custom-input 
                            mb-3 mb-lg-0 borderc-secondary" (change)="onProductSelect($event)"
                  style="height:20px; text-align: right;" formControlName="stock_quantity" readonly>
              </div>
            </td>
            <td style="width: 5%;" class="text-center">
              <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                &nbsp;&nbsp;<button title="Add" (click)="AddProduct()" type="button"
                  class="btn btn-icon btn-sm bg-success me-1">
                  <span Class="fa-solid fa-plus text-white  fs-6"></span></button>&nbsp;
              </div>
            </td>
          </tr>
          <tr *ngFor="let data of productsummary_list; let i=index;">
            <td>{{data.productgroup_name}}</td>
            <td>{{data.product_code}}</td>
            <td style="text-align: left;">{{data.product}}</td>
            <td style="text-align: center;">{{data.display_field}}</td>
            <td style="text-align: right;">{{data.qty_requested}} </td>
            <td style="text-align: right;">{{data.productuom_name}}</td>
            <td style="text-align: right;">{{data.stock_quantity}}</td>
            <td class="text-center">
              <button type="button" data-bs-toggle="modal" data-bs-target="#myModaldeleteQA"
                class="btn btn-icon btn-sm bg-danger me-1">
                <i class="fa-solid fa-trash"></i>

              </button>
            </td>

          </tr>
        </tbody>

      </table>
    </form>
    <!-- </div> -->
  </div>
  <!-- --------------Third Tab ------------- -->

  <div class="card mt-1 m-3 mb-0">
    <form [formGroup]="opendcForm">
      <div class="m-4 card">
        <div class="text-center my-4">
          <button (click)="onSubmit()" type="submit" class="btn-success btn-sm text-white me-2">
            <i class="fas fa-check fs-5"></i>
            <span class="ms-3">Submit</span> </button>

        </div>
      </div>
    </form>

    <div class="modal" id="myModaldeleteQA" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content del_modal-content">
          <div class="text-center my-4">
            <h2><b>Are you sure?</b></h2>
            <p style="display: block;">Do You Want To Delete the Record ?</p>
            <div class="text-center my-4">
              <button class="btn-danger btn-sm text-white me-4" data-bs-dismiss="modal" (click)="ondelete()">
                <i class="bi bi-trash-fill text-white fs-5 me-2"></i>Delete
              </button>
              <button class="btn-primary btn-sm text-white me-2" data-bs-dismiss="modal">
                <i class="fas fa-close text-white me-2"></i>Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>