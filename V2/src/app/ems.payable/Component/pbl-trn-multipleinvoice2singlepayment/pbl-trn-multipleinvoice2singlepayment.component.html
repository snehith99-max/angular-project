<div class="card m-5">

  <div class="card-title p-2 rounded-top bg-primary d-flex justify-content-between align-items-center">
    <h1 class="fw-bolder ms-3 text-white"><i class="fa-solid fa-money-bill-wave fs-2"
      aria-hidden="true"></i>&nbsp;&nbsp;Make Payment</h1>
    <button style="color: black !important;" class="btn btn-icon btn-sm bg-secondary cursor-pointer " title="Back"
      routerLink="/payable/PblTrnPaymentAddProceed"><i class="fa-solid fa-arrow-left-long fs-1 fw-bold"></i></button>
 </div>



 <div class="card mt-1 m-3 mb-0">
  <div class="card-header d-flex align-items-center mb-3 cursor-pointer" style="background-color: #def0ff;">
      <div>
          <p class="card-title fw-bold fs-3 " style="color: #2599ff;">
              <i class="fa-solid fa-clipboard fs-1"></i> &nbsp;Payment Details
          </p>
      </div>
  </div>

  <div>
    <form [formGroup]="reactiveForm" #form="ngForm">
      <div *ngFor="let data of vendor_lists;" class="gs-7">
     
         <div class="d-flex flex-row m-4  flex-wrap row">

          <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="fw-bold ">Payment Date</span>
            <div class="col-lg-8 col-12 col-md-11 mb-6 col-sm-11 fv-row mt-2">
                <input type="date" pattern="^(?!\s*$).+"
                    [ngStyle]="{ 'border-color': reactiveForm.get('payment_date')?.hasError('required')
                     && reactiveForm.get('payment_date')?.touched ? 'red' : 'rgb(209, 209, 209)' , 'height': '36px'}"
                    formControlName="payment_date"
                    class="form-control form-control-lg form-control-solid date-picker custom-input mb-3 mb-lg-0 bg-white custom-input date-picker mt-2"
                    placeholder="DD-MM-YYYY" />
            </div>
          </div>
<!-- <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="fw-bold ">Entered By</span>
            <p class="mt-3">{{this.name}}</p>
        </div> -->

        <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="fw-bold ">Vendor Name</span>
          <p class="mt-3">{{this.vendor_companyname}}</p>
          <p class="mt-3">{{this.Vendor_details}}</p>
      </div>
      
      <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="fw-bold ">Vendor Address</span>
        <p class="mt-3">{{this.vendoraddress}}</p>
    </div>
    <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="fw-bold ">Currency Code / Exchange Rate</span>
      <p class="mt-3">{{this.currency_code}}     /     {{this.exchange_rate}}</p>
     </div>
    </div>
    <div class="d-flex flex-row m-4  flex-wrap row">
      <div class="col-lg-6 col-md-12 col-sm-12 ">
        <span class="font-bold">Payment Remarks</span>
        <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
                <textarea style="width: 95%"  type="text" 
                 [ngStyle]="{ 'border-color': reactiveForm.get('payment_remarks')?.hasError('required') && reactiveForm.get('payment_remarks')?.touched ? 'red' : 'rgb(209, 209, 209)' }"
                pattern="^(?!\s*$).+"  formControlName="payment_remarks" placeholder="Enter Payment Remarks"
                class="form-control form-control-lg form-control-solid  mb-3 mb-lg-0 bg-white  mt-2" rows="3"
                ></textarea>
        </div>
    </div>
    

    <div class="col-lg-6 col-md-12 col-sm-12 ">
      <span class="font-bold">Payment Note</span>
      <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
              <textarea style="width: 95%;" type="text"  [ngStyle]="{ 'border-color': reactiveForm.get('payment_note')?.hasError('required') && reactiveForm.get('payment_note')?.touched ? 'red' : 'rgb(209, 209, 209)' }"
              pattern="^(?!\s*$).+"  formControlName="payment_note" placeholder="Enter Payment Remarks"
              class="form-control form-control-lg form-control-solid  mb-3 mb-lg-0 bg-white  mt-2" rows="3"
              ></textarea>
            </div>
          </div>
        </div>
      </div>


      <div class="table-responsive">
        <div class= "card card-body m-0 p-3 mb-5 bg-white rounded table-responsive">
          <table id="singlepayment_list" class="table table-striped table-bordered text-blue border-bottom gs-7 align-middle">
            <thead>
              <tr class="fw-bold fs-6 text-nowrap bg-lightblue text-blue align-middle">
                <!-- <th>
                  <input type="checkbox" id="checkAll" class="mt-2" (change)="$event ? masterToggle() : null" 
                  [checked]="selection.hasValue() && isAllSelected()" 
                  [indeterminate]="selection.hasValue() && !isAllSelected()">
                </th> -->
            
                <th class="text-blue text-center" style="width:8%;">Invoice Date</th>
                <th class="text-blue text-center" style="width:8%;">Invoice Ref.No</th>
                <th class="text-blue text-center" style="width:8%;">Invoice Amount</th>
                <th class="text-blue text-center" style="width:8%;">Paid Amount</th>
                <th class="text-blue text-center" style="width:8%;">Outstanding Amount</th>
                <!-- <th class="text-blue text-center" style="width:6%;">Status</th>
                <th class="text-blue text-center" style="width:8%;">Advance</th> -->
                <th class="text-blue text-center" style="width:8%;">Payment Amount</th>
                <!-- <th style="text-align: right; width: 70px;">Balance PO Advance</th>
                <th style="text-align: right; width: 70px;">Total PO Advance</th> -->
                 <!-- <th class="text-blue text-center" style="width:8%;">Grand Total</th>  -->
                <th class="text-blue text-center" style="width:8%;">TDS Amount</th>
                <th class="text-blue text-center" style="width:8%;">Bank Charges</th>
                <th class="text-blue text-center" style="width:8%;">Exchange Loss</th>
                <th class="text-blue text-center" style="width:8%;">Exchange Gain</th>
                 <th class="text-blue text-center" style="width:8%;">Final Amount</th>
                <th class="text-blue text-center" style="width:8%;">Remarks</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of singlepayment_list; let i=index;" class="align-middle gs-7">
                <!-- <td>
                  <input type="checkbox" (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(data) : null" [checked]="selection.isSelected(data)" />
                </td> -->
               
                <td style="text-align: center;">{{data.invoice_date}}</td>
                <td style="text-align: center;">{{data.invoice_refno}}</td>
                <td style="text-align: right;">
                  {{ data.invoice_amount | number:'1.2-2' }} / {{this.currency_code}} 
                  <br>
                 <span *ngIf="this.currency_code != this.currency"> {{ (data.invoice_amount * this.exchange_rate) | number:'1.2-2' }} / {{this.currency}}</span>  
                </td>
                <td style="text-align: right;">{{data.payed_amount | number:'1.2-2'}}</td>
                <td style="text-align: right;">{{data.outstanding | number:'1.2-2'}} / {{this.currency_code}} 
                  <br>
                  <span *ngIf="this.currency_code != this.currency">{{ (data.outstanding * this.exchange_rate) | number:'1.2-2' }} / {{this.currency}}</span>
                </td>
                <!-- <td style="text-align: center;">{{data.invoice_status}}</td>
                <td style="text-align: right;">{{data.advance}}</td> -->
                <!-- <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.advance" style=" text-align: right;" 
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="advance_{{i}}" (keypress)="onKeyPress($event)"  readonly/>
                </td> -->
                <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.payment_amount" style=" text-align: right; height: 1px;"
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="payment_amount_{{i}}" (input)="prodtotalcal(i)" (keypress)="onKeyPress($event)" />
                </td>
                <!-- <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.balancepo_advance" style=" text-align: right;"
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="balancepo_advance_{{i}}" (keypress)="onKeyPress($event)" />
                </td>
                <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.totalpo_advance" style=" text-align: right;"
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="totalpo_advance_{{i}}" (keypress)="onKeyPress($event)" />
                </td> -->
                 <!-- <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.grand_total" style=" text-align: right; height: 1px;"
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary" formControlName="grand_total_{{i}}" (input)="prodtotalcal(i)" (keypress)="onKeyPress($event)"  readonly />
                </td> -->
                <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.tds_amount" style=" text-align: right; height: 1px;" 
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="tds_amount_{{i}}" (input)="prodtotalcal(i)" (keypress)="onKeyPress($event)" />
                </td>

                <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.bankcharges" style=" text-align: right; height: 1px;" 
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="bankcharges_{{i}}" (input)="prodtotalcal(i)" (keypress)="onKeyPress($event)" />
                </td>
                <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.exchangeloss" style=" text-align: right; height: 1px;" 
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="exchangeloss_{{i}}" (input)="prodtotalcal(i)" (keypress)="onKeyPress($event)" />
                </td>
                <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.exchangegain" style=" text-align: right; height: 1px;" 
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="exchangegain_{{i}}" (input)="prodtotalcal(i)" (keypress)="onKeyPress($event)" />
                </td>

              <td style="text-align: right;">
                  <input type="text" [(ngModel)]="data.final_amount" style=" text-align: right; height: 1px;"
                  class="form-control form-control-lg form-control-solid custom-input mb-3 mb-lg-0 bg-white 
                  custom-input borderc-secondary"
                  formControlName="final_amount_{{i}}" (input)="prodtotalcal(i)" readonly (keypress)="onKeyPress($event)" />
                </td> 
                <td>
                  <textarea id="remark" row="3"   class="form-control form-control-lg form-control-solid
                  border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" 
                  id="payment_remarks"
                   formControlName="remark_{{i}}" rows="1"></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    
      <div class="d-flex flex-row  m-2  flex-wrap row">
        <div class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row ">
            <span class="font-bold required">Payment Mode</span>

            <ng-select formControlName="payment_mode" 
            [ngClass]="{'invalid-border': payment_mode.invalid && payment_mode.touched}" 
            bindLabel="payment_mode" 
            (change)="showTextBox($event)">
            <ng-option value="">--Select an option--</ng-option>
            <ng-option value="Cash">Cash</ng-option>
            <ng-option value="Cheque">Cheque</ng-option>
            <ng-option value="DD">DD</ng-option>
            <ng-option value="Credit Card">Credit Card</ng-option>
            <ng-option value="NEFT">NEFT</ng-option>
          </ng-select>

          </div>
        </div>        
      

      <div  *ngIf="showInput">
        <div class="d-flex flex-row pt-3 flex-wrap row">

          <div class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="font-bold">Bank Name</span>          
            <ng-select formControlName="bank_name" [class.is-invalid]="bank_name.invalid &&
             (bank_name.dirty || bank_name.touched)" 
             [ngClass]="{'invalid-border': bank_name.invalid && bank_name.touched}"
              [items]="bankdetailslist" class="custom col-lg-11 col-12 col-md-11 col-sm-11
               fv-row mt-3" bindLabel="bank_name" bindValue="bank_gid"
                placeholder="Select Bank Name" [(ngModel)]="bank_name1"></ng-select>
        </div>
      

        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row"><span class="font-bold">Cheque No</span>
            <input formControlName="cheque_no" type="text" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" placeholder="Enter Cheque No" name="cheque_no" />
          </div>
        </div>

        <div class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row"><span class="font-bold">Branch Name</span>
            <input formControlName="branch_name" type="text" [(ngModel)]="branchche" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" placeholder="Enter Branch Name" name="branch_name" />
          </div>
        </div>
      </div>

        
      <div class="d-flex flex-row pt-3 flex-wrap row">

        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-5"><span class="font-bold">Date</span>
              <input formControlName="payment_date" type="date" style="width:247px;" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" name="payment_date" />
            </div>
          </div>
        </div>
      </div>     

      <div  *ngIf="showInput2">
        <div class="d-flex flex-row pt-3 flex-wrap row">

          <div  class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="font-bold">Bank Name</span>          
          <ng-select formControlName="bank_name" [class.is-invalid]="bank_name.invalid && (bank_name.dirty || bank_name.touched)" 
          [ngClass]="{'invalid-border': bank_name.invalid && bank_name.touched}" [items]="bankdetailslist" 
          class="custom col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-3"  
          bindLabel="bank_name" bindValue="bank_gid"
          placeholder="Select Bank Name"></ng-select>
        </div>

        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row"><span class="font-bold">DD No.</span>
            <input formControlName="dd_no" type="text" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" placeholder="Enter DD No." name="dd_no" />
          </div>
        </div>

        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row "><span class="font-bold">Branch Name</span>
            <input formControlName="branch_name" type="text" [(ngModel)]="branch_namedd"
             class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" placeholder="Enter Branch Name" name="branch_name" />
          </div>
        </div>

        </div>

        <div class="d-flex flex-row  flex-wrap row">
          <div class="col-12 col-lg-3 col-md-6 col-sm-12">
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row "><span class="font-bold">Date</span>
              <input formControlName="payment_date" type="date" class="form-control form-control-lg form-control-solid  borderc-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" name="payment_date" />
            </div>
          </div>
        </div>
       
      </div>

      <div class="d-flex flex-row pt-3 flex-wrap row" *ngIf="showInput3">
        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row "><span class="font-bold">Card Name</span>
            <ng-select formControlName="card_name" [(ngModel)]="cardname" [class.is-invalid]="card_name.invalid && (card_name.dirty || card_name.touched)"
             [ngClass]="{'invalid-border': card_name.invalid && card_name.touched}" [items]="carddetailslist" 
            style="width: 247px;" class="custom col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-3" bindLabel="bank_name" bindValue="bank_name" placeholder="Select Card Name"></ng-select>
          </div>
        </div>

        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row "><span class="font-bold">Transaction No.</span>
            <input formControlName="transaction_no" type="text" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" placeholder="Enter Transaction No." name="transaction_no" />
          </div>
        </div>
      </div>

      <div   *ngIf="showInput4">
        <div class="d-flex flex-row pt-3 flex-wrap row">
        <div  class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="font-bold">Bank Name</span>          
          <ng-select formControlName="bank_name" [(ngModel)]="branchnameneft" [class.is-invalid]="bank_name.invalid && (bank_name.dirty || bank_name.touched)" [ngClass]="{'invalid-border': bank_name.invalid && bank_name.touched}" [items]="bankdetailslist" class="custom col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-3" bindLabel="bank_name" bindValue="bank_gid" placeholder="Select Bank Name"></ng-select>
        </div>

        <div class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row"><span class="font-bold">Transaction Ref. No.</span>
            <input formControlName="cheque_no" type="text" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" placeholder="Enter Cheque No" name="cheque_no" />
          </div>
        </div>

        <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row "><span class="font-bold">Branch Name</span>
            <input formControlName="branch_name" type="text" class="form-control form-control-lg 
            form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input 
            " placeholder="Enter Branch Name" name="branch_name" />
          </div>
        </div>
        </div>
        <div class="d-flex flex-row pt-3  flex-wrap row">
          <div  class="col-12 col-lg-3 col-md-6 col-sm-12">
            <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row "><span class="font-bold">Date</span>
              <input formControlName="payment_date" type="date" class="form-control form-control-lg form-control-solid  borderc-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3" name="payment_date" />
            </div>
          </div>
        </div>
       

      </div>

      <div  *ngIf="showInput5">
        <div class="d-flex flex-row pt-3 flex-wrap row">
          <div  class="col-12 col-lg-3 col-md-6 col-sm-12"><span class="font-bold">Date</span>
          <input formControlName="payment_date" type="date" style="width: 247px;" class="form-control form-control-lg form-control-solid border-secondary custom-input mb-3 mb-lg-0 bg-white custom-input mt-3"/>
        </div>
      </div>
        
      </div>
</div>
      <div class="text-center my-4 mt-10">
        <button class="btn-success btn-sm text-white me-4" (click)="onsubmit()">
          <i class="fas fa-check fs-5"></i> &nbsp;Submit
        </button>
        <button class="btn-primary btn-sm text-white me-4" routerLink="/payable/PblTrnPaymentAddProceed">
          <i class="fas fa-arrow-left"></i>
          Back
      </button>
    
      </div>
    </form>
  </div>
