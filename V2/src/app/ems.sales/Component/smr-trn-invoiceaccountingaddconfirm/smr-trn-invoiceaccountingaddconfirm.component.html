<div class="card rounded-top">
    <div class="card-title p-5 pb-6 pt-6 rounded-top bg-primary">
      <h3 class="fw-bolder text-white">
        + Invoice Add Confirm
      </h3>
    </div>
  
    <form [formGroup]="invoiceaccountingform">
      <div class="card m-3 border">
        <div class="card-header bg-lightblue card-height55">
          <div class="card-title m-0">
            <h4 class="fw-bolder text-blue">Invoice Details</h4>
          </div>
        </div>
      </div>
  
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold required">Invoice Reference No</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary custom-input"
              formControlName="invoiceaccounting_refno" placeholder="New Reference No."
              [ngStyle]="{'border-color': invoiceaccountingformrefnoControl.invalid && invoiceaccountingformrefnoControl.touched ? 'red' : 'rgb(209, 209, 209)'}"
              pattern="^(?!\s*$).+" readonly>
            <div *ngIf="invoiceaccountingformrefnoControl.invalid && invoiceaccountingformrefnoControl.touched">
              <div *ngIf="invoiceaccountingformrefnoControl.hasError('required')" class="text-red">Invoice
                ref.no is required</div>
            </div>
          </div>
        </div>
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold required">Invoice Date</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="date"
              class="form-control form-control-lg form-control-solid date-picker mb-3 mb-lg-0 bg-white border-secondary custom-input"
              formControlName="invoice_date"
              [ngStyle]="{'border-color': invoiceaccountingdateControl.invalid && invoiceaccountingdateControl.touched ? 'red' : 'rgb(209, 209, 209)'}"
              pattern="^(?!\s*$).+">
            <div *ngIf="invoiceaccountingdateControl.invalid && invoiceaccountingdateControl.touched">
              <div *ngIf="invoiceaccountingdateControl.hasError('required')" class="text-red">Invoice date is
                required</div>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Order Ref No</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary border-secondary custom-input"
              formControlName="invoiceaccounting_orderrefno" readonly>
          </div>
        </div>
        
      </div>
  
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-6 col-sm-12 mt-2"><span class="font-bold">Order Date</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <div class="position-relative">
              <input type="date" placeholder="DD-MM-YYYY"
                     class="form-control form-control-lg form-control-solid date-picker mb-3 mb-lg-0 bg-secondary border-secondary custom-input"
                     formControlName="invoiceaccounting_orderdate" readonly
                     style="pointer-events: none;">
              <div class="date-picker-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: auto;"></div>
            </div>
            
          </div>
        </div>
        <div class="col-12 col-lg-4 col-md-6 col-sm-12 mt-2"><span class="font-bold">Payment Term (In Days)</span>
          <ng-select class="col-12 col-lg-11 col-md-11 col-sm-11 fv-row mt-2" formControlName="invoiceaccounting_payterm"
            [(ngModel)]="mdlaccpayterm" placeholder="Select an option">
            <ng-option value="0">0 Days</ng-option>
            <ng-option value="7">7 Days</ng-option>
            <ng-option value="15">15 Days</ng-option>
            <ng-option value="30">30 Days</ng-option>
            <ng-option value="45">45 Days</ng-option>
            <ng-option value="60">60 Days</ng-option>
            <ng-option value="90">90 Days</ng-option>
            <ng-option value="120">120 Days</ng-option>
          </ng-select>
        </div>
        <div class="col-12 col-lg-4 col-md-6 col-sm-12 mt-2">
          <span class="font-bold">Due Date</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="date" placeholder="DD-MM-YYYY"
              class="form-control form-control-lg form-control-solid date-picker mb-3 mb-lg-0 bg-white border-secondary custom-input"
              formControlName="invoiceaccounting_duedate">
          </div>
        </div>
      </div>
  
      <div class="card m-3 border">
        <div class="card-header bg-lightblue card-height55">
          <div class="card-title m-0">
            <h4 class="fw-bolder text-blue">Customer Details</h4>
          </div>
        </div>
      </div>
  
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Customer</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary custom-input fw-bold"
              formControlName="invoiceaccounting_customername" readonly>
          </div>
        </div>
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Email</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary custom-input fw-bold"
              formControlName="invoiceaccounting_email" readonly>
          </div>
        </div>
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold">Contact Person</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary custom-input fw-bold"
              formControlName="invoiceaccounting_contactperson" readonly>
          </div>
        </div>
      </div>
  
      <div class="d-flex flex-row m-6 flex-wrap">
        <div class="col-12 col-lg-4 col-md-6 col-sm-12 mt-2"><span class="font-bold">Contact Number</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary custom-input fw-bold"
              formControlName="invoiceaccounting_contactnumber" readonly>
          </div>
        </div>
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12 mt-2"><span class="font-bold">Customer Address</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <textarea type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary border-secondary custom-input fw-bold"
              formControlName="invoiceaccounting_customeraddress" rows="3" class="form-control bg-secondary"
              readonly></textarea>
          </div>
        </div>
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12 mt-2"><span class="font-bold">Branch</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <input type="text"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary custom-input fw-bold"
              formControlName="invoiceaccounting_branch" readonly>
          </div>
        </div>
      </div>
  
      <div class="d-flex flex-row m-6 flex-wrap">
        
         
          <div class="col-12 col-lg-4 col-md-6 col-sm-12">
            <span class="font-bold">Currency / Rate</span>
            <div class="d-flex col-12 fv-row mt-2">
              <div class="col-8 pe-2">
                <input type="text"
                  class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary border-secondary custom-input"
                  formControlName="invoiceaccounting_currency" readonly>
              </div>
              <div class="col-3">
                <input type="text"
                  class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-secondary border-secondary custom-input fw-bold"
                  formControlName="invoiceaccounting_exchangerate" readonly style="text-align: right;">
              </div>
            </div>
          </div>
          
        
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold required">Sales Type</span>
          <ng-select class="col-12 col-lg-11 col-md-11 col-sm-11 fv-row mt-2"
            formControlName="invoiceaccounting_salestype" [(ngModel)]="mdlaccsalestype" placeholder="Select an option"
            [class.is-invalid]="invoiceaccountingform.get('invoiceaccounting_salestype')?.invalid && (invoiceaccountingform.get('invoiceaccounting_salestype')?.dirty || invoiceaccountingform.get('invoiceaccounting_salestype')?.touched)"
            [ngClass]="{'invalid-border': invoiceaccountingform.get('invoiceaccounting_salestype')?.invalid && invoiceaccountingform.get('invoiceaccounting_salestype')?.touched}">
            <ng-option value="Services and Enterprise Product">Services and Enterprise Product</ng-option>
            <ng-option value="Service type">Service type</ng-option>
            <ng-option value="B2B">B2B</ng-option>
          </ng-select>
          <div
            *ngIf="invoiceaccountingform.get('invoiceaccounting_salestype')?.hasError('required') && invoiceaccountingform.get('invoiceaccounting_salestype')?.touched || invoiceaccountingform.get('invoiceaccounting_salestype')?.hasError('pattern')"
            class="text-red">Sales type is required</div>
        </div>
  
        <div class="col-12 col-lg-4 col-md-6 col-sm-12"><span class="font-bold required">Remarks</span>
          <div class="col-lg-11 col-12 col-md-11 col-sm-11 fv-row mt-2">
            <textarea type="text" rows="1"
              class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 bg-white border-secondary custom-input"
              formControlName="invoiceaccounting_remarks" rows="3"></textarea>
          </div>
        </div>
      </div>
  
      
    </form>
  
    <div class="card-header bg-lightblue card-height55">
      <div class="card-title m-0">
        <h4 class="fw-bolder text-blue">Product Summary</h4>
      </div>
    </div>
    <div class="table-responsive">
      <div class="mx-3 p-3 pt-0 pb-0 bg-white rounded mt-2">
        <table id="product" class="table table-striped table-row-bordered border-bottom gs-7 align-middle">
          <thead>
            <tr class="fw-bolder fs-5 text-nowrap bg-lightblue text-blue align-middle">
              <th style="text-align: center;">S.No</th>
              <th>SKU</th>
              <th>Product</th>
              <th>Qty</th>
              <th>Unit Price</th>
              <th>Discount</th>
             
              <th>VAT</th>
              <th>Total Price</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of invoiceaccountinglist; let i = index;" class="align-middle">
              <td style="text-align: center;">{{i + 1}}</td>
        
              <td>
                <input type="text" class="form-control fw-bold" [value]="data.customerproduct_code"
                  style="width: 120px;" readonly>
              </td>
        
              <td>
                <input type="text" class="form-control fw-bold" [value]="data.product_code + ' / ' + data.product_name"
                  style="width: 250px;" readonly>
              </td>
        
              <td>
                <input type="text" class="form-control fw-bold"
                  style="width: 120px;text-align: right;" readonly [(ngModel)]="data.qty_quoted + ' ' + data.unit" (input)="prodtotalcal1(i)">
              </td>
  
              <td style="text-align: right;">
                <input type="text" class="form-control fw-bold " [(ngModel)]="data.product_price"
                  style="width: 100px; text-align: right;" (input)="prodtotalcal1(i)" readonly>
              </td>
  
             
        
              <td>
                <div class="d-flex align-items-center">
                    <input type="text" class="form-control fw-bold" [(ngModel)]="data.discount_percentage"
                        style="width:80px; text-align: right;" readonly (input)="onChangediscountamount(i)">
                    <span class="ms-2">%</span>
                </div>
                <!-- <div class="d-flex align-items-center mt-2">
                    <input type="text" class="form-control fw-bold" [(ngModel)]="data.discount_amount"
                      readonly  style="width: 100px; text-align: right;" (input)="onChangediscountamount(i)" >
                </div> -->
            </td>
            
            <td style="width: 30%;">
              <div class="row align-items-center" *ngIf="data.tax !== null && data.tax !== undefined">
                  <input type="text" class="form-control fw-bold" [value]="data.tax + ':' + data.tax_amount1" style="width: 100%; text-align: center;" readonly>
              </div>
              <div class="row align-items-center" *ngIf="data.tax2 !== null && data.tax2 !== undefined">
                  <input type="text" class="form-control fw-bold" [value]="data.tax2 + ':' + data.tax_amount2" style="width: 100%; text-align: center;" readonly>
              </div>
              <div class="row align-items-center" *ngIf="data.tax3 !== null && data.tax3 !== undefined">
                  <input type="text" class="form-control fw-bold" [value]="data.tax3 + ':' + data.tax_amount3" style="width: 100%; text-align: center;" readonly>
              </div>
              <div class="row align-items-center">
                  <div class="col-6">
                      <ng-select class="col-12 fv-row mt-2" [items]="tax_list" 
                          (change)="onChangeTaxAmount($event, i)" [(ngModel)]="data.tax4_gid" 
                          style="width:100%; text-align: left;" bindLabel="tax_name" bindValue="tax_gid" placeholder="Select Tax">
                      </ng-select>
                  </div>
                  <div class="col-6">
                      <input type="text" class="form-control fw-bold bg-secondary mt-2" 
                          [(ngModel)]="data.tax_amount4" (change)="onChangeTaxAmount($event,i)" 
                          style="width:100%; text-align: right;height: 40px; " readonly>
                  </div>
              </div>
          </td>
          
         
          
              <!-- <td style="width: 30%;">
                <div class="row align-items-center" *ngIf="data.tax !== null && data.tax !== undefined">
                <input type="text" class="form-control fw-bold" [(ngModel)]="data.tax + ':' + data.tax_amount1 "
                style="width: 100%; text-align: center;" >
              </div>
              <div class="row align-items-center" *ngIf="data.tax2 !== null && data.tax2 !== undefined">
                <input type="text" class="form-control fw-bold" [(ngModel)]="data.tax2 + ':' + data.tax_amount2 "
                style="width: 100%; text-align: center;" >
              </div>
                <div class="row align-items-center" *ngIf="data.tax3 !== null && data.tax3 !== undefined">
                  <input type="text" class="form-control fw-bold" [(ngModel)]="data.tax3 + ':' + data.tax_amount3 "
                  style="width: 100%; text-align: center;" >
              </div>
                <div class="row align-items-center">
                  <div class="col-6">
                      <ng-select class="col-12 fv-row mt-2" [items]="tax_list" 
                          (change)="onChangeTaxAmount($event, i)" [(ngModel)]="data.tax_gid" 
                          style="width:100%; text-align: left;"  bindLabel="tax_name" bindValue="tax_gid" placeholder="Select Tax">
                      </ng-select>
                  </div>
                  <div class="col-6">
                      <input type="text" class="form-control fw-bold bg-secondary" 
                          [(ngModel)]="data.tax_amount" (change)="onChangeTaxAmount($event,i)" 
                          style="width:100%; text-align: right;" readonly>
                  </div>
              </div>
            </td>
             -->
            
  
              <td style="text-align: right; font-weight: bold;">
                <input type="text" (change)="calcNetAmount()"
                  class="form-control fw-bold " [(ngModel)]="data.total_amount"
                  style="width: 120px; text-align: right;" readonly>
              </td>
            </tr>
          </tbody>
        </table>
        
      </div>
    </div>
  
    <form [formGroup]="invoiceaccountingform">
      <div class="m-4 card">
        <div class="row">
          <div class="col-lg-8">
            <div class="mt-4 card border">
              <div class="d-flex justify-content-between align-items-center rounded-top" style="background-color: #def0ff;">
                <div>
                  <h3 class="fw-bolder ms-3 mt-2" style="color: #2599ff;">Terms and Conditions</h3>
                </div>
                <div class="col-4">
                  <ng-select [items]="terms_list" class="custom mt-2 me-2 mb-2" bindLabel="template_name" [(ngModel)]="mdlTerms"
                    formControlName="template_name" bindValue="template_gid" placeholder="Select an option"
                    (change)="GetOnChangeTerms()"></ng-select>
                </div>
              </div>
              <div class="m-3">
                <angular-editor [config]="config" formControlName="invoiceaccounting_termsandconditions"></angular-editor>
              </div>
            </div>
          </div>
    
          <div class="col-lg-4">
            <div class="mt-4 card border" style="background-color: #f9f9f99d;">
  
              <div class="row g-6 p-3">
              
                <div class="col-lg-12">
                  <span class="font-bold">Net Amount</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                    <input type="text" class="form-control fw-bold custom-input text-end"
                        formControlName="invoiceaccounting_ordertotal" [(ngModel)]="netamount" readonly>
                   
                </div>
                </div>
                
                <!-- <div class="col-lg-6">
                  <span class="font-bold">Tax</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                    <input type="text" class="form-control fw-bold" [(ngModel)]="taxamount" (input)="finaltotal()"
                      formControlName="invoiceaccounting_overall_tax" style="width: 170px;height: 40px; text-align: right;" readonly>
                  </div>
                </div> -->
                
                <div class="col-lg-6">
                  <span class="font-bold">Tax Amount</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                    <input type="text" class="form-control fw-bold  bg-secondary" [(ngModel)]="taxamount" (input)="finaltotal()"
                      formControlName="invoiceaccounting_overall_tax" style="width: 170px; height: 40px;text-align: right;" readonly>
                  </div>
                </div>
                
                <div class="col-lg-6">
                  <span class="font-bold">Order Add On Charges</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                    <input type="text" class="form-control fw-bold bg-secondary" [(ngModel)]="orderaddon" (input)="finaltotal()"
                    readonly  formControlName="invoiceaccounting_addon_amount" style="width: 170px; height: 40px;text-align: right;">
                  </div>
                </div>
                
                <div class="col-lg-6">
                  <span class="font-bold">Order Discount Amount</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                    <input type="text" class="form-control fw-bold bg-secondary" [(ngModel)]="orderdiscount" (input)="finaltotal()"
                    readonly formControlName="invoiceaccouting_orderdiscountamount" style="width: 170px; height: 40px;text-align: right;">
                  </div>
                </div>
                
                <div class="col-lg-6">
                  <span class="font-bold">Order Total Amount</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                    <input type="text" class="form-control fw-bold  bg-secondary" [(ngModel)]="orderamount" (input)="finaltotal()"
                    readonly  formControlName="invoiceaccounting_ordertotal_withtax" style="width: 170px; height: 40px;text-align: right;">
                  </div>
                </div>
  
                <div class="col-lg-6">
                <span class="font-bold">Freight Charges</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                <input type="text" class="form-control" [(ngModel)]="freightcharges" (input)="finaltotal()"
                formControlName="invoiceaccounting_freightcharges" style="width: 170px; height: 40px;text-align: right;">
                </div>
                </div>
  
                <div class="col-lg-6">
                <span class="font-bold">Buy Back Charges</span>
                  <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                <input type="text" class="form-control" [(ngModel)]="buybackcharges" (input)="finaltotal()"
                formControlName="invoiceaccounting_buybackcharges" style="width: 170px; height: 40px;text-align: right;">
  </div>
                </div>
  
                <div class="col-lg-6">
                  <span class="font-bold">Packing Charges</span>
                    <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                <input type="text" class="form-control" [(ngModel)]="packingcharges" (input)="finaltotal()"
                  formControlName="invoiceaccounting_packingcharges" style="width: 170px; height: 40px;text-align: right;">
  </div>
                </div>
  
                  <div class="col-lg-6">
                    <span class="font-bold">Insurance Charges</span>
                      <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                  <input type="text" class="form-control" [(ngModel)]="insurancecharges" (input)="finaltotal()"
                  formControlName="invoiceaccounting_insurancecharges" style="width: 170px; height: 40px;text-align: right;">
  </div>
                </div>
  
                  <div class="col-lg-6">
                    <span class="font-bold">Outstanding Invoice Amount</span>
                      <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                  <input type="text" class="form-control" [(ngModel)]="outstandingamout" (input)="finaltotal()"
                  formControlName="invoiceaccounting_outstandingamount" style="width: 170px; height: 40px;text-align: right;" readonly>
  </div>
                </div>
  
                  <div class="col-lg-6">
                    <span class="font-bold">Roundoff</span>
                      <div class="col-lg-12 col-12 col-md-12 col-sm-12 fv-row mt-4">
                  <input type="text" class="form-control" [(ngModel)]="roundoff" (input)="finaltotal()"
                  formControlName="invoiceaccounting_roundoff" style="width: 170px; height: 40px;text-align: right;">
  </div>
                </div>
              </div>
  
  
              <div class="row mt-2">
  
                <div class="col-lg-12">
                  <div>
                    <hr>
                  </div>
                </div>
  
                <div class="col-lg-12 d-flex justify-content-between align-items-center">
                  <div class="fw-bold fs-1 ms-3">Grand Total :</div>
                  <div class="col-lg-4">
                    <input type="text" class="form-control fw-bold bg-secondary custom-input"
                      formControlName="invoiceaccounting_grandtotal" [(ngModel)]="grandtotal" (ngModelChange)="finaltotal()"
                      style="background-color: #f9f9f99d !important;border: none !important;font-size: medium !important;text-align: right !important;"
                      readonly>
                      
                  </div>
                </div>
  
              
              </div>
            </div>
          </div>
        <div class="text-center my-4">
          <button type="submit" class="btn-success btn-sm text-white me-2" (click)="salesinvoicesubmit()">
            <i class="bi bi-check-square fs-5"></i>
            <span class="ms-3">Submit</span>
          </button>
      
          <button class="btn-primary btn-sm text-white me-4" routerLink="/smr/SmrTrnInvoiceraise">
            <i class="fas fa-arrow-left"></i> &nbsp; Back
        </button>
  
        </div>
        
      </div>
    </div>
    </form>
    
  
  </div>